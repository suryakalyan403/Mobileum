apiVersion: v1
kind: Pod
metadata:
  name: {{include "aip.names.fullname" . }}-connection-test
  labels: {{- include "aip.labels.standard" . | nindent 4 }}
  annotations:
    helm.sh/hook: test
spec:
  restartPolicy: OnFailure
  containers:
    - name: connection-test
      image: {{ include "aip.images.image" ( dict "image" .Values.image )}}
      imagePullPolicy: {{ .Values.image.pullPolicy }}
      terminationMessagePolicy: FallbackToLogsOnError
      command: ["wget"]
      args:
        - --no-check-certificate
        - --tries=5
        - {{ .Release.Name }}:{{ .Values.deployment.xdtPort }}/healthz
      resources: {{ include "aip.resources.requests" ( dict "resources" .Values.deployment.resources "context" $ ) | nindent 8 }}
