apiVersion: v1
kind: Pod
metadata:
  name:  {{ include "aip.names.fullname" . }}-test
  labels: {{- include "aip.labels.standard" . | nindent 4 }}
  annotations: {{- include "aip.annotations.standard" . | nindent 4 }}
    {{- if .Values.testAnnotation }}
    {{- include "aip.renderer" ( dict "value" .Values.testAnnotation "context" $ ) | nindent 4 }}
    {{- end }}
spec:
  containers:
    - name: {{ include "aip.names.fullname" . }}-test
      image: {{ include "aip.images.image" ( dict "image" .Values.image )}}
      imagePullPolicy: {{ .Values.image.pullPolicy }}
      command: ["/bin/bash","-c"]
      args: 
        {{- if .Values.tls.enabled }}
        - curl -k {{ include "aip.names.fullname" . }}:8443/health/ready
        {{ else }}
        - curl {{ include "aip.names.fullname" . }}:8080/health/ready
        {{- end }}
  restartPolicy: Never